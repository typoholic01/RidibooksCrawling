<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="Post">

	<!-- 						CREATE 						-->
	<!-- 게시물 입력 -->
	<insert id="insertPost" parameterType="Post" useGeneratedKeys="false">
		INSERT INTO Posts(
			boardSeq,groupNo,seq,userId,title,content
		)
		VALUES(
			#{boardSeq}, nextval('postSeq'), currval('postSeq'), #{userId}, #{title}, #{content}
		)
	</insert>

	<!-- 						READ 						-->
	<!-- 게시물들 가져오기 -->
	<select id="getPostList" resultType="Post" parameterType="QueryPost">
		SELECT 
			depth,seq,status,userId,title,content,readCount,createAt
		FROM Posts
		ORDER BY groupNo DESC, depth ASC
		WHERE boardSeq = #{boardSeq}
		AND status = 1
		LIMIT #{startArticle}, #{articleLimit}
	</select>
	
	<!-- 게시물 하나 가져오기 -->
	<select id="getPost" resultType="Post" parameterType="Integer">
		SELECT 
			depth,seq,status,userId,title,content,readCount,createAt
		FROM Posts
		WHERE seq = #{seq}
	</select>
	
	<!-- 총 게시물 수 가져오기 -->
	<select id="getTotalPost" parameterType="String" resultType="Integer">
		SELECT NVL(COUNT(seq), 0)
		FROM Posts
		WHERE boardSeq = #{boardSeq}
		AND status = 1
	</select>
	
	<!-- Update -->
	<update id="updatePost" parameterType="Post">
		UPDATE Posts
		SET title = #{title},
			content = #{content}
		WHERE boardSeq = #{boardSeq}
		AND seq = #{seq}
	</update>
	
	<!-- 						DELETE 						-->
	<update id="deletePost" parameterType="Integer">
		UPDATE Posts
		SET status = 0
		WHERE seq = #{seq}
	</update>
</mapper>